<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>受講コース一覧 | 学習管理システム</title>
    <link rel="stylesheet" th:href="@{/static/common.css}">
    <link rel="stylesheet" th:href="@{/static/courses.css}">
</head>
<body>

<div th:replace="~{layout/header :: header}"></div>
<div th:replace="~{layout/tabs :: tabs(activeTab='courses')}"></div>

<main class="courses-container">
    <h2 class="page-title">受講可能なコース</h2>

    <section class="courses-list">
        <div class="course-card"
             th:classappend="' status-' + (${course.enrollmentStatus != null} ? ${course.enrollmentStatus.toLowerCase()} : 'unknown')"
             th:each="course : ${courses}">

            <!-- 상단 -->
            <div class="card-top">
                <div class="card-header">
                    <h3 th:text="${course.title}">JavaScript入門講座</h3>

                    <p class="course-desc"
                       th:text="${course.descriptionSimple != null ? course.descriptionSimple : 'コースの概要は準備中です。'}">
                        基礎文法からDOM操作までを学ぶ入門コースです。
                    </p>
                </div>

                <div class="card-body">
                    <p class="course-deadline">
                        受講期限：
                        <span th:text="${course.deadline != null ? #dates.format(course.deadline, 'yyyy-MM-dd') : '制限なし'}">
                            2025-05-01
                        </span>
                    </p>
                </div>
            </div>

            <!-- 하단 -->
            <div class="card-bottom">
                <div class="course-meta">
                    <span class="progress"
                          th:if="${course.progressRate != null and course.progressRate > 0}">
                        進捗：<span th:text="${course.progressRate + '%'}">50%</span>
                    </span>
                </div>

                <div class="course-actions">
                    <th:block th:with="now=${#dates.createNow()},
                       status=${course.enrollmentStatus != null ? course.enrollmentStatus : 'NOT_ENROLLED'}">

                        <!-- 수강 신청 가능 -->
                        <a class="btn-enroll"
                           th:href="@{'/courses/' + ${course.id}}"
                           th:if="${status == 'NOT_ENROLLED' and (course.deadline == null or course.deadline.time > now.time)}">
                            受講申請
                        </a>

                        <!-- 신청 중 -->
                        <a class="btn-active"
                           th:href="@{'/courses/' + ${course.id}}"
                           th:if="${status == 'PENDING'}">
                            申請中
                        </a>

                        <!-- 수강 중 -->
                        <a class="btn-active"
                           th:href="@{'/courses/' + ${course.id}}"
                           th:if="${status == 'ENROLLED'}">
                            続きから学習
                        </a>

                        <!-- 완료 -->
                        <a class="btn-active"
                           th:href="@{'/courses/' + ${course.id}}"
                           th:if="${status == 'COMPLETED'}">
                            復習する
                        </a>

                        <!-- 기한 지남 -->
                        <button class="btn-disabled"
                                disabled
                                th:if="${status == 'NOT_ENROLLED' and (course.deadline != null and course.deadline.time <= now.time)}">
                            受講期限切れ
                        </button>
                    </th:block>
                </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 페이지 네비게이션 -->
    <div class="pagination" th:if="${totalPages > 1}">
        <a th:href="@{/courses(page=${page - 1})}" th:if="${page > 1}">前へ</a>
        <span th:text="${page} + ' / ' + ${totalPages}">1 / 3</span>
        <a th:href="@{/courses(page=${page + 1})}" th:if="${page < totalPages}">次へ</a>
    </div>
</main>
</body>
</html>
