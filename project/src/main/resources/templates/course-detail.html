<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${course.title} + ' | 学習管理システム'">講義詳細</title>
    <link rel="stylesheet" th:href="@{/static/common.css}">
    <link rel="stylesheet" th:href="@{/static/course-detail.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body>

<!-- 헤더 & 탭 -->
<div th:replace="~{layout/header :: header}"></div>
<div th:replace="~{layout/course-tabs :: courseTabs(${course.id}, 'detail')}"></div>

<main class="course-container">

    <div class="alert alert-error" th:if="${errorMessage}">
        <i class="fa-solid fa-circle-exclamation"></i>
        <span th:text="${errorMessage}"></span>
    </div>

    <!-- 강의 헤더 -->
    <section class="course-header">
        <div class="course-header-top">
            <div class="course-title-group">
                <h1 th:text="${course.title}">JavaScript基礎</h1>
                <p class="teacher" th:text="${course.teacherName}">高橋佑真</p>
            </div>

            <!-- 상태별 버튼 -->
            <div class="course-actions" th:switch="${course.enrollmentStatus}">

                <!-- ENROLLED -->
                <a class="btn-outline"
                   th:case="'ENROLLED'"
                   th:href="@{'/courses/' + ${course.id} + '/learn'}">
                    続きから学習する
                </a>

                <!-- NOT_ENROLLED -->
                <a class="btn-outline"
                   th:case="'NOT_ENROLLED'"
                   th:href="@{'/courses/' + ${course.id} + '/enroll'}"
                   th:if="${course.deadline == null or course.deadline.time > #dates.createNow().time}">
                    受講申請
                </a>
                <button class="btn-outline btn-disabled"
                        disabled
                        th:case="'NOT_ENROLLED'"
                        th:if="${course.deadline != null and course.deadline.time <= #dates.createNow().time}">
                    受講期限切れ
                </button>

                <!-- PENDING -->
                <div class="btn-pending-group" th:case="'PENDING'">
                    <span class="btn-outline btn-pending-disabled">申請中</span>
                    <a class="btn-outline cancel-btn"
                       th:href="@{'/courses/' + ${course.id} + '/cancel'}">申請取消</a>
                </div>

                <!-- COMPLETED -->
                <a class="btn-outline"
                   th:case="'COMPLETED'"
                   th:href="@{'/courses/' + ${course.id} + '/review'}">
                    復習する
                </a>

            </div>
        </div>
    </section>

    <!-- 강의 설명 -->
    <section class="course-description">
        <h2>こういう事を学びます</h2>
        <div class="description-text" th:utext="${#strings.replace(course.description, '\n', '<br/>')}">
            JavaScriptの基本的な文法とデータ型の使い方を理解します。<br>
            ・変数・関数・条件分岐・ループなどを学びます。<br>
            ・ブラウザでの動作やDOM操作を理解します。<br>
            ・イベント処理を学びます。
        </div>
    </section>

    <!-- 섹션 + 강의 목록 -->
    <section class="sections">
        <div class="section-box" th:each="section : ${course.sections}">
            <details>
                <summary th:text="${section.title}">はじめに</summary>
                <ul class="lecture-list">
                    <li th:each="lecture : ${section.lectures}">
                        <span class="lecture-title">
                            <i class="fa-solid fa-play"></i>
                            <span th:text="${lecture.title}">JavaScriptの紹介</span>
                        </span>
                        <span class="lecture-duration" th:text="${lecture.formattedDuration}"></span>
                    </li>
                </ul>
            </details>
        </div>
    </section>

</main>
</body>
</html>
