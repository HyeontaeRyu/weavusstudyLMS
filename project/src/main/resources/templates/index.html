<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ダッシュボード | 学習管理システム</title>
    <link rel="stylesheet" th:href="@{/static/common.css}">
    <link rel="stylesheet" th:href="@{/static/dashboard.css}">
</head>
<body>

<div th:replace="layout/header :: header"></div>
<div th:replace="layout/tabs :: tabs(activeTab='dashboard')"></div>

<main class="dashboard-container">
    <section class="summary-cards">
        <div class="card">
            <p class="card-title">受講中コース</p>
            <p class="card-value" th:text="${enrolledCount}">0</p>
        </div>

        <div class="card">
            <p class="card-title">完了コース</p>
            <p class="card-value" th:text="${completedCount}">0</p>
        </div>
    </section>

    <section class="notification-section">
        <h2>お知らせ</h2>

        <div class="no-notification" th:if="${#lists.isEmpty(notifications)}">
            <p>現在お知らせはありません。</p>
        </div>

        <div class="notification-list" th:if="${!#lists.isEmpty(notifications)}">
            <div class="notification-item" th:classappend="${n.isRead} ? 'read' : ''" th:each="n : ${notifications}">
                <div class="notification-content">
                    <p class="notification-message" th:text="${n.message}"></p>
                    <p class="notification-time" th:text="${#temporals.format(n.sentAt, 'yyyy-MM-dd HH:mm')}"></p>
                </div>
                <div class="notification-actions">
                    <button th:if="${!n.isRead}" th:onclick="|markAsRead(${n.id})|">既読にする</button>
                    <button th:onclick="|deleteNotification(${n.id})|">削除</button>
                </div>
            </div>
        </div>
    </section>
</main>

<script>
    async function markAsRead(id) {
        await fetch(`/notifications/${id}/read`, {method: 'POST'});
        location.reload();
    }

    async function deleteNotification(id) {
        await fetch(`/notifications/${id}/delete`, {method: 'POST'});
        location.reload();
    }
</script>

</body>
</html>
